<html
    window-resizable="true"
    window-width="600dip"
    window-height="400dip"
>
<head>
<title>sciter utils demo</title>
<style>

@import url(vendor/8ctopus/sciter-logger/src/logger.css);

body {
    border-spacing: 1em;
}

plaintext#logger {
    size: *;
}

</style>
<script type="module">

import {logger} from "vendor/8ctopus/sciter-logger/src/logger.js";

import * as utils from "src/utils.js";

document.ready = function() {
    // initialize logger
    logger.init();

    // subscribe to logger messages
    logger.plaintext(document.$("plaintext#logger"));

    // attach logger to console
    logger.attach();

    // capture unhandled exceptions
    logger.capture();

    // log sciter version
    console.debug(utils.sciterInfo());

    // add support for F5 reload
    utils.addReloadWindow();

    // close window on escape key press
    utils.closeWindowOnEscape(Window.this);

    // center window on screen
    utils.centerWindow(Window.this, "screen");

    // center window around position
    utils.centerWindowXY(Window.this, 1200, 600);

    // bring window to front
    utils.windowToFront(Window.this);

    // add minimize window shortcut
    utils.minimizeWindowShortcut();

    // add keyboard shortcut
    utils.addKeyboardShortcut(document, {
        key: "KeyM",
        ctrlKey: true,
    }, function(event) {
        console.log(utils.keyStr(event) + " pressed");
        return false;
    })

    // create new window to test centering on parent
    const window = new Window({
        parent: Window.this,
        url   : __DIR__ + "window.html",
        state : Window.WINDOW_SHOWN,
        alignment: 1,
    });

    // add key logger
    utils.keyLogger(document, function(event) {
        console.log(utils.keyStr(event) + " pressed");
        return false;
    });

    // dpi stuff
    console.line();
    console.log(`device DPI = pixels in 1 inch - ${utils.devicePixels()}`);
    console.log(`device pixels in 1 cm - ${utils.devicePixels("1cm")}`);
    console.log(`device pixels in 1 mm - ${utils.devicePixels("1mm")}`);

    console.line();
    console.log(`what is 96dip (1 inch) in ppx on a 142 DPI screen? - ${utils.dip_ppx("96dip", 142)}`);
    console.log(`what is 142ppx in dip on a 142 DPI screen? - ${utils.ppx_dip("142ppx", 142)}`);
    console.log(`what is 10cm in ppx on a 142 DPI screen? - ${utils.mm_ppx("100mm", 142)}`);

    console.line();
    console.log(`monitors count - ${utils.monitorsCount()}`);
    utils.logMonitors();
    console.log(`window is on monitor - ${Window.this.screen + 1}`);

    console.line();

    // test sleep function
    console.log("Sleep for 500ms");
    utils.sleep(500);

    // play sound
    let file = "C:\\Windows\\Media\\notify.wav";

    const promise = utils.play(file);

    promise.then(
        function(success) {
            console.note("Play sound - OK");
        },
        function(error) {
            console.error("Play sound - FAILED");
        });

    // test json
    let json = {};

    const url = __DIR__ + "test/test.json";

    utils.loadJson(url, json);
    utils.saveJson(url, json);
}

document.on("click", "button#link", function(event, element) {
    utils.openLink(element.attributes["href"]);
});

// window size in dpi
let a = [500, 200];

document.on("click", "button#resize", function(event, element) {
    // resize window
    utils.setWindowDimensions(Window.this, a[0], a[1], false);

    a = utils.windowDimensions(Window.this, false);

    console.log(a);
});

</script>
</head>
<body>
    <button href="https://duckduckgo.com" #link>search</button>
    <button #resize>resize window</button>
    <plaintext #logger readonly />
</body>
</html>
